pattern:
  id: determinability_gate
  name: Determinability Gate (Interface-Bounded)
  status: library-non-core
  intent: 'Allow AI assistance only where facts are determinable from an operational
    interface (e.g., UI/HMI/API) or certified sensors. If not determinable, AI is
    explicitly detached from decision support.

    '
positioning:
  under: VCDesign (constraints) / AI positioning
  note: 'This is not VCDesign core. It is a field constraint to preserve responsibility
    boundaries.

    Domain-specific mappings (e.g., ''CI'', ''HMI'', ''SCADA'') should live in profiles/examples,
    not in this core pattern.

    '
scope:
  applies_to:
  - abnormal_operation
  - recovery_attempt
  - post_isolation_support
  excludes:
  - physical_root_cause_inference
  - hazard/safety_chain_diagnosis
  - non_determinable_power_or_supply_assumption
definitions:

  gate_output:
    description: >
      Determinability Gate output is intentionally minimal.
      The gate emits a binary decision (**pass**/**block**) plus optional
      annotations for downstream routing.

      - **decision** is the only normative outcome.
      - **annotations** are *non-normative* attributes that MUST NOT change
        the determinability judgement. They exist to support risk-based
        downstream handling (e.g., batch vs spot-check vs per-item review).
    fields:
      decision:
        type: enum
        values: [pass, block]
      reason:
        type: enum
        values: [interface_determinable, not_determinable]
      annotations:
        type: object
        optional: true
        contains: [source_method, interaction_type, evidence_ref, quality_band]

  gate_annotations:
    description: >
      Optional, discrete tags attached to a gate output.
      These tags describe the *nature of the evidence* (source / interaction)
      so that downstream RP (approval layer) can decide whether to
      batch-approve, spot-check, or require per-item review.

      Avoid numerical confidence unless absolutely required.
      Prefer coarse bands with explicit provenance.

  source_method:
    description: >
      How the fact was obtained.
      This is not a correctness score; it is provenance.
    type: enum
    values:
      - direct_api
      - certified_signal
      - screen_text
      - computer_vision
      - manual_entry
    notes:
      - direct_api is typically batch-approvable when the API is contract-trusted.
      - computer_vision often needs stricter downstream review due to false positives.

  interaction_type:
    description: >
      What kind of interface interaction produced the record.
      Distinguish passive display from active human input.
    type: enum
    values:
      - system_display
      - system_event
      - human_input
      - device_action
    notes:
      - system_display/event may be batch-approved.
      - human_input/device_action may require per-item review due to responsibility weight.

  evidence_ref:
    description: >
      A reference to supporting evidence that can be inspected by a human.
      Example: log_id, screenshot_id, camera_frame_id, trace_id.
    type: string
    examples:
      - "log://hmi/ALM-4512"
      - "img://camera-12/frame/2026-01-02T10:12:03+09:00"
      - "ticket://MAINT-2026-00031"

  quality_band:
    description: >
      Coarse quality classification for routing purposes.
      This is intentionally *not* a probability.
    type: enum
    values: [high, medium, low]
    optional: true
    notes:
      - Use only when downstream routing cannot be derived from source_method.
      - If present, MUST be accompanied by evidence_ref.

  determinable_fact:
    description: >
      A fact that can be asserted without physical or causal assumption,
      based solely on interface-observable state or certified signals.
    allowed_sources:
      - interface_observable_state
      - certified_signal
      - human_interface_operation_log

  non_determinable_state:
    description: >
      Any state that requires assumption, interpretation,
      physical inspection, recurrence, or disassembly
      to be asserted.
    includes:
      - inferred_physical_condition
      - causal_attribution
      - hidden_state_behind_interface
      - condition_requiring_assumption

  interface_observable_state:
    description: >
      A state explicitly presented by an interface
      as-is, without interpretation.
    examples:
      - enabled_or_disabled
      - displayed_message
